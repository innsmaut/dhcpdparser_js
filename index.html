<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8/Windows-1251" />
        <title></title>
    </head>
    <body>
<input type="file" onchange="handleFileSelect(this.files)" multiple />
<output id="list"></output>

        <button onclick="console.log(readedLogs)">Print fie into console</button>
        <button onclick="parseAll()">Search for matches</button>

<input type="file" onchange="handleFileSelect(this.files)" />
<output id="list"></output>

        <button onclick="parseClist()">Read clients base</button>

<script>
    var readedLogs = [];
    function handleFileSelect(evt)
    {
        var files = evt;
        var reader = {};
        for (var i = 0; i < files.length; i++)
        {
            var f = files[i];
            reader[i] = new FileReader;
            reader[i].readAsText(f);
            reader[i].onload = function (x)
            {
                readedLogs.push(x.target.result);
            }
        }
    }
</script>

<script>
    function parseM(n)
    {
        var parseSummary = [[]];
        strToParse = readedLogs[n];
        parseArr = strToParse.split(/\w\w\w  \d \d\d:\d\d:\d\d amon-ra dhcpd: /);
        for (var i = 4; i < parseArr.length; i++)
        {
            if (parseArr[i].slice(4, 7) == 'ACK')
            {
                clIp = parseArr[i - 1].match(/(80|188)\.\d+\.\d+\.\d+/);
                swIp = parseArr[i - 1].match(/172\.\d+\.\d+\.\d+/);
                swPort = parseArr[i - 4].match(/\d+/);
                clMac = parseArr[i].match(/..:..:..:..:..:../);
                if (clIp)
                {
                    parseSummary[clIp[0]] = [swIp.toString(), swPort.toString(), clMac.toString(), clIp[0]];
                }
            }
        }
        return parseSummary;
    }

    function parseAll()
    {
        var arrToMatch = [[]];
        var matchedArr = [[]];
        for (i = 0; i < readedLogs.length; i++)
        {
            arrToMatch = parseM(i);
            for (key in arrToMatch)
            {
                matchedArr[key] = arrToMatch[key];
            }
        }
        //console.dir(matchedArr);
    }

    function parseClist()
    {
        var resClist = [[]];
        logins = 0;
        names = 0;
        accs = 0;
        rawClist = readedLogs[readedLogs.length - 1];
        splittedClist = rawClist.split(String.fromCharCode(13));
        for (i = 0; i < splittedClist.length; i++)
        {
            clientIp = splittedClist[i].match(/((80.77|188.247)\.\d+\.\d+)/);
            if (clientIp)
            {
                clLogin = splittedClist[i].match(/(\w+)<\/td><td valign=top>/);
                clName = splittedClist[i].match(/class=s>(.*)<\/td><td valign=top><a href/);
                clAcc = splittedClist[i].match(/td><td valign=top>(\S*)\s*</);

                if (clLogin && clName && clAcc)
                {
                    resClist[clientIp[0]] = [clLogin[1].trim(), clName[1].trim(), clAcc[1]];
                }
            }
        }
        console.log(resClist);
        console.log(splittedClist);
        //document.getElementById('rawlist').innerHTML = splittedClist;
    }




        </script>    
        <p id="rawlist"></p>
    </body>
</html>
