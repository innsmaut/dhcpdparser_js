<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title></title>
    </head>
    <body>
<input type="file" id="files" name="files[]" onchange="handleFileSelect(this.files)" multiple />
<output id="list"></output>

        <button onclick="console.log(readedLogs)">Print fie into console</button>
        <button onclick="parseAll()">Search for matches</button>



<script>
    var readedLogs = [];
    function handleFileSelect(evt)
    {
        var files = evt;
        var reader = {};
        for (var i = 0; i < files.length; i++)
        {
            var f = files[i];
            reader[i] = new FileReader;
            reader[i].readAsText(f);
            reader[i].onload = function (x)
            {
                readedLogs.push(x.target.result);
            }
        }
    }
</script>

<script>
    function parseM(n)
    {
        var parseSummary = [[]];
        strToParse = readedLogs[n];
        parseArr = strToParse.split(/\w\w\w  \d \d\d:\d\d:\d\d amon-ra dhcpd: /);
        for (var i = 4; i < parseArr.length; i++)
        {
            if (parseArr[i].slice(4, 7) == 'ACK')
            {
                clIp = parseArr[i - 1].match(/(80|188)\.\d+\.\d+\.\d+/);
                swIp = parseArr[i - 1].match(/172\.\d+\.\d+\.\d+/);
                swPort = parseArr[i - 4].match(/\d+/);
                clMac = parseArr[i].match(/..:..:..:..:..:../);
                if (clIp)
                {
                    parseSummary[clIp[0]] = [swIp.toString(), swPort.toString(), clMac.toString(), clIp[0]];
                }
            }
        }
        //console.log(parseSummary);
        return parseSummary;
    }

    function parseAll()
    {
        var arrToMatch = [[]];
        var matchedArr = [[]];
        for (i = 0; i < readedLogs.length; i++)
        {
            arrToMatch = parseM(i);
            for (key in arrToMatch)
            {
                //console.log(arrToMatch[key]);
                matchedArr[key] = arrToMatch[key];
            }
        }
        console.dir(matchedArr);

    }






        </script>    

    </body>
</html>
